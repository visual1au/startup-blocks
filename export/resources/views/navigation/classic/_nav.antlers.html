<nav
    x-data="{ mobileMenuIsOpen: false, scrolled: window.scrollY > 0 }"
    @click.away="mobileMenuIsOpen = false"
    @scroll.window="scrolled = window.scrollY > 0"
    :class="{ 'scrolled': scrolled }"
    aria-label="menu"
    class="main {{ class }}"
>
    <div class="content-area">
        <!-- Brand Logo -->
        <a href="/" class="hover:animate-jelly">
            {{ partial:components/logo }}
        </a>
        <!-- Desktop Menu -->
        <ul class="nav-items">
            {{ nav:main_nav }} {{ if children }}
            <div
                x-data="{ isOpen: false, openedWithKeyboard: false }"
                class="relative w-fit"
                x-on:keydown.esc.window="isOpen = false, openedWithKeyboard = false"
            >
                <!-- Toggle Button -->
                <li>
                    <a
                        class="cursor-pointer group relative w-max"
                        x-on:click="isOpen = ! isOpen"
                        x-on:keydown.space.prevent="openedWithKeyboard = true"
                        x-on:keydown.enter.prevent="openedWithKeyboard = true"
                        x-on:keydown.down.prevent="openedWithKeyboard = true"
                        x-bind:aria-expanded="isOpen || openedWithKeyboard"
                    >
                      <span>{{ title }}  <i
                            class="fa-regular fa-sm"
                            :class="isOpen || openedWithKeyboard ? 'fa-chevron-up' : 'fa-chevron-down'"
                        ></i></span>
                        <span class="absolute -bottom-1 right-0 w-0 transition-all h-0.5 bg-primary group-hover:w-full"></span>
                    </a>
                </li>

                <!-- Sub Menu -->
                <div
                    x-cloak
                    x-show="isOpen || openedWithKeyboard"
                    x-transition
                    x-trap="openedWithKeyboard"
                    x-on:click.outside="isOpen = false, openedWithKeyboard = false"
                    x-on:keydown.down.prevent="$focus.wrap().next()"
                    x-on:keydown.up.prevent="$focus.wrap().previous()"
                    class="sub-menu"
                    role="menu"
                >
                    {{ children }}
                    <a
                        href="{{ url }}"
                        class="bg-white px-4 py-2 text-sm text-black hover:text-secondary"
                        role="menuitem"
                        >{{ title }}</a
                    >
                    {{ /children }}
                </div>
            </div>
            {{ else }}
            <li>
                <a
                href="{{ url }}"
                class="{{ if is_current }} text-primary {{ /if }} group relative w-max"
                >
                    <span>{{ title }}</span>
                    <span class="absolute -bottom-1 right-0 {{ if is_current }} w-full {{ else }} w-0 {{ /if }} transition-all h-0.5 bg-primary group-hover:w-full"></span>
                </a>
            </li>
            {{ /if }} {{ /nav:main_nav }}
        </ul>

        <a
            href="/#contact"
            class="{{ if environment !== "production" }} runningButton {{ /if }} btn btn-primary btn-desktop hover:animate-jelly"
            >
            Contact Us
        </a>

        <!-- Mobile Menu Button -->
        <button
            @click="mobileMenuIsOpen = !mobileMenuIsOpen"
            :aria-expanded="mobileMenuIsOpen"
            :class="mobileMenuIsOpen ? 'is-open' : null"
            type="button"
            class="mobile-menu"
            aria-label="mobile menu"
            aria-controls="mobileMenu"
        >
            <svg
                x-cloak
                x-show="!mobileMenuIsOpen"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                aria-hidden="true"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="size-6"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
                />
            </svg>
            <svg
                x-cloak
                x-show="mobileMenuIsOpen"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                aria-hidden="true"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="size-6"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M6 18 18 6M6 6l12 12"
                />
            </svg>
        </button>

        <!-- Mobile Menu -->
        <ul
            x-cloak
            x-show="mobileMenuIsOpen"
            x-transition:enter="transition motion-reduce:transition-none ease-out duration-300"
            x-transition:enter-start="-translate-y-full"
            x-transition:enter-end="translate-y-0"
            x-transition:leave="transition motion-reduce:transition-none ease-out duration-300"
            x-transition:leave-start="translate-y-0"
            x-transition:leave-end="-translate-y-full"
            id="mobileMenu"
            class="mobile-menu"
        >
            {{ nav:main_nav }} {{ if children }}
            <li class="py-4"><a href="{{ url }}">{{ title }}</a></li>
            <ul>
                {{ children }}
                <li class="ml-6 space-x-2 py-0">
                    <i class="fa-regular fa-chevron-right fa-sm"></i
                    ><a href="{{ url }}">{{ title }}</a>
                </li>
                {{ /children }}
            </ul>
            {{ else }}
            <li class="py-4">
                <a
                    href="{{ url }}"
                    class="{{ if is_current }} text-primary {{ /if }}"
                    >{{ title }}</a
                >
            </li>
            {{ /if }} {{ /nav:main_nav }}
            <a
                href="/#contact"
                class="btn btn-primary mt-4 flex justify-center"
            >
                Contact Us
            </a>
        </ul>
    </div>
</nav>
